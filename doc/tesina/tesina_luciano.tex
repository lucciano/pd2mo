\documentclass[a4paper,	11pt]{report}
%-----------Paquetes-------------------------

\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage[spanish]{babel}
%\renewcommand{\abstractname}{Resumen: }

\begin{document}

\renewcommand\floatpagefraction{.9}
\renewcommand\topfraction{.9}
\renewcommand\bottomfraction{.9}
\renewcommand\textfraction{.1}
\setcounter{totalnumber}{50}
\setcounter{topnumber}{50}
\setcounter{bottomnumber}{50}

\title{Conversión de modelos PowerDEVS al lenguaje Modelica}
\author{Tesinista: Luciano Andrade \\ Director: Federico Bergero, Co-Director: Ernesto Kofman} 

\maketitle
\tableofcontents

\begin{abstract}
%\section{Resumen}
En este trabajo se describe la implementación de una aplicación para convertir modelos descriptos en la herramienta PowerDEVS a modelos en el lenguaje Modelica, más especificamente en $\mu$Modelica, con el fin de aprovechar la velocidad de simulación del 'QSS Solver', permitiendo describir las simulaciones en el entorno PowerDEVS y ejecutando las simulaciones en 'QSS Solver'
\end{abstract}


\chapter{Introducción}
\section{Motivación y Objetivos}
PowerDEVS es una herramienta de simulación de sistemas híbridos, basado en el formalismo DEVS, con una interfaz grafica orientada a bloques, donde los bloques pueden ser conectados entre si, modificado los parametros, posibilidad de conectarse con el entorno Scilab para poder utilizar expresiones y herramientas de cálculo provistas por este entorno.
La resolución de ecuaciones diferenciales ordinarias, requiere el uso de métodos de integración numérica. Todos los algoritmos tradicionales de integración se basan en la discretización de la variable independiente (que generalmente representa el tiempo). Las rutinas que implementan estos algoritmos, se denominan solvers y existen gran variedad de implementaciones de los mismos en diferentes lenguajes de programación. Los Métodos de Integración Numérica QSS (Quantized State System), a diferencia de los métodos de integración tradicionales, realizan la discretización sobre las variables de estado. En consecuencia, convierten los sistemas continuos en sistemas de eventos discretos, y tienen grandes ventajas para simular sistemas con discontinuidades.
Si bien PowerDEVS, implementa la totalidad de los algoritmos de QSS, resultan ineficientes, dado que malgastan gran parte de la carga computacional en la transmisión de eventos entre submodelos.
Para solventar este hecho se desarrollo una familia de QSS stand-solver, el cual requiere un modelo descripto en lenguaje C el cual contiene las equaciones difereciales, las funciones de cruce de cero asi como la información estructural requerida por los algoritmos QSS. Estos solvers obtienen una mejora de performace de hasta un orden de maginitud comparado con otras implementaciones DEVS.
Sobre este se desarrollo una herramineta la cual genera a partir de un modelo $\mu$-Modedelica (un subconjunto del lenguaje Modelica) el modelo requerido para el QSS solver.
Con el objetivo de utilizar los mejoras de velocidad y mantener un entorno amigable con el usuario, se creo una herramienta capas de convertir un modelo PowerDEVS en un modelo $\mu$-Modelica.


\section{Trabajo relacionado}
¿Cuales?
\section{Alcance}
DEVS, Discrete Event System Specification (Especificación de Sistemas de Eventos Discretos), es un formalismo modular y jerarquico para modelar y analizar sistemas que pueden ser de eventos de tiempo discreto mediante tablas de transición, y con estados continuos mediantes que pueden ser descriptos mediantes equaciones diferenciales.
En el formalismo clasico DEVS, los modelos atómicos capturan el comportamiento del sistema, mientras los modelos Acoplados describen la estructura del sistema.
En particular los modelos atómicos en PowerDEVS son descriptos en clases C++, mientras que la estructura se encuentra definida en archivos pds y pdm.
Modelica es un lenguaje de modelado, orientado a objetos, declarativo, para el modelado orientado a componentes de sistemas complejos.
Para poder realizar nuestro objetivo es necesario primero contar con un modelo  en modelica para cada atómico PowerDEVS que deseemos convertir. 

De esto se desprenden las siguientes limitaciones importantes:
\begin{itemize}
	\item La semántica de los modelos convertidos depende de los modelos equivalentes a los DEVS atómicos 
	\item Solamente podemos convertir modelos cuyos componentes atómicos estén o puedan ser convertidos a $\mu$modelica.
\end{itemize}
	
\chapter{Conceptos Previos}
En este capítulo introducimos algunos conceptos básicos, necesarios para poder comprender este trabajo.
\section{Modelado y Simulación}

Modelado y Simulación de un Sistema es el proceso por el cual se desarrolla un modelo, el cual es luego simulado, de forma de obtener datos sobre el sistema. El modelo debe conservar las principales características del sistema, pero al mismo tiempo ser significativamente más simple, de forma que al momento de simularlo sea más eficaz utilizar la simulación que el sistema en si.

\subsection{Sistemas Continuos y Discretos}
Se considera un sistema continuo si las variables de este son conocidas en cada instante de tiempo, mientras que se considera discreto si las variables son conocidas en instantes de tiempo determinados.

En general los sistemas en estudio serán continuos, pero deberemos utilizar sistemas discretos puesto que la simulación en computadora así lo requiere, puesto que la misma computadora es un sistema discreto.

\subsection{Métodos de Integración numérica}

Un sistema continuo puede ser descripto por un modelo en espacios de estados de la forma:

\begin{equation} \label{eq1}
x(t) = f (x(t), u(t))
\end{equation}

donde $x \in \Re^n$  es el vector de estados, $u \in \Re^m$ es una función de entradas conocidas,
$t$ representa el tiempo y con sus condiciones iniciales:

\begin{equation} \label{eq2}
x(t = t 0 ) = x 0
\end{equation}

Sea $x_i (t)$ la trayectoria del estado $i$-esimo expresada como función de tiempo simulado. 
Mientras que la ecuación \eqref{eq1} no contenga discontinuidades $x_i (t)$ será una función continua con derivada continua. Esta puede ser aproximada con la precisión deseada mediante series de Taylor en cualquier punto de su trayectoria

Denominando $t^{\ast}$ al instante de tiempo en torno al cual se aproxima la trayectoria mediante una serie de Taylor, y siendo $t^{\ast} + h$ el instante de tiempo en el cual se quiere evaluar la aproximación, entonces, la trayectoria en dicho punto puede expresarse como sigue:

\begin{equation} \label{eq3}
x_i(t^* + h) = x_i(t^*) + \frac{dx_i (t^*)}{dt} \cdot h + \frac{d^{2}x_i (t^*)}{dt^2} \cdot \frac{h^2}{2!} + \cdots
\end{equation}

Reemplazando con la ecuación de estado \eqref{eq1}, la serie \eqref{eq3} queda:

\begin{equation} \label{eq4}
x_i(t^* + h) = x_i(t^*) + f_i(t^*) \cdot h + \frac{d^{2}x_i (t^*)}{dt^2} \cdot \frac{h^2}{2!} + \cdots
\end{equation}

Los distintos algoritmos de integración difieren en la manera de aproximar las derivadas superiores de $f$ y en el número de términos de la serie de Taylor que consideran para la aproximación.

\section{Formalismo DEVS}

DEVS es un formalismo para modelar y analizar sistemas de eventos discretos (es decir, sistemas en los cuales en un lapso finito de tiempo, ocurren una cantidad finita de eventos).
Un modelo DEVS puede ser visto como un autómata que procesa una serie de eventos de entrada y genera una serie de eventos de salida. Este procesamiento está regido por la estructura interna de cada una de las partes que componen el modelo general.
Un modelo DEVS está descripto por dos clases de componentes, modelos atómicos y modelos acoplados.

\subsection{Atómicos}

Un modelo atómico representa la unidad "indivisible" de especificación, en el sentido que es la pieza fundamental y más básica de un modelo DEVS. Formalmente un modelo atómico está conformado por la 7-upla:

\begin{equation} 
(X, Y, S, \delta_{int} , \delta_{ext}, \lambda, t_{a}) \mbox{ donde :}
\end{equation}

\begin{itemize}
\item $X$ es el conjunto de valores de entrada que acepta el modelo atómico, es decir un evento de entrada tiene como valor un elemento del conjunto X.
\item $Y$ es el conjunto de valores de los eventos de salida que puede emitir el modelo atómico.
\item $S$ es el conjunto de estados internos del modelo, en todo momento el atómico está en un estado dado, que es un elemento del conjunto S.
\item $ta$ es una función $S \to R^{+}$ , que indica cuánto tiempo el modelo atómico permanecerá en un estado dado, si es que no se recibe ningún evento de entrada. Esta función puede asociarse también al tiempo de vida de un estado.
\item $\delta_{int}$ es una función $S \to S$, que indica la dinámica del sistema en el momento que el modelo atómico realiza una transición interna. Sería el análogo a una tabla de transición en otros autómatas.
\item $\delta_{ext}$ es una función $(S \times R^{+} \times X) \to S$, que indica el cambio de estado ante la presencia de un evento externo.
\item $\lambda$ es una función $S \to Y$ que indica qué evento se debe emitir al salir de un estado dado.
\end{itemize}

Los conjuntos $S$, $X$ e $Y$ son arbitrarios, y en general infinitos. Cada posible estado $s$ ($s \in S$) tiene asociado un Avance de Tiempo calculado por la Función de Avance de Tiempo $ta(s)$.
En la Figura 2.5 vemos la evolución de un modelo atiómico. Si el estado toma el valor $s_1$ en el tiempo $t_1$ , tras $ta(s_1)$ unidades de tiempo (o sea, en tiempo $ta(s_1 ) + t_1 )$ el sistema realizará una transición interna yendo a un nuevo estado $s_2$ dado por $s_2 = \delta_{int} (s_1 )$. La función $\delta_{int}$ se llama Función de Transición Interna.

Cuando el estado va de $s_1$ a $s_2$ se produce también un evento de salida con valor $y_1 = \lambda(s_1)$. La función $\lambda (\lambda : S \to Y )$ se llama Función de Salida. Así, las funciones $ta$, $\delta_{int}$ y $\lambda$ definen el comportamiento autónomo de un modelo DEVS.

Cuando llega un evento de entrada, el estado cambia instantáneamente. El nuevo valor del estado no sólo depende del valor del evento de entrada sino también del valor anterior del estado y del tiempo transcurrido desde la última transición.

Si el sistema llega al estado $s_3$ en el instante $t_3$ y luego llega un evento de entrada en el instante $t_3 + e$ con un valor $x_1$ , el nuevo estado se calcula como $s_4 = \delta_{ext} (s_3 , e, x_1 )$ (notar que $ta(s_3 ) > e$). En este caso se dice que el sistema realiza una transición externa. La función $\delta_{ext}$ se llama Función de Transición Externa. Durante una transición externa no se produce ningún evento de salida.

%XXX : Falta figura 2.5 - Ber12, pag. 22

\subsection{Acoplados}
La descripción de un sistema puede ser completamente realizada utilizando modelos atómicos, aunque esto resulta un poco incómodo y confuso. Los conjuntos de estados y las funciones de transición se vuelven inmanejables en sistemas complejos, y nunca podemos asegurar haber cubierto todos los posibles estados.
Para abordar este problema, el formalismo DEVS introduce lo que se llaman modelos acoplados (ver Figura 2.6) que es una forma de agrupar modelos DEVS y generar nuevos modelos a partir de este agrupamiento.
Hay dos formas de acoplamiento, la más general, en la cual se utilizan funciones de traducción entre los sub–sistemas y otra clase que adopta el uso de puertos para la comunicación entre sub–sistemas. Aunque estas dos formas son equivalentes entre sí, describiremos la segunda clase, ya que es la más simple y es la utilizada en el presente trabajo.
Formalmente un modelo acoplado está representado por la octo-upla:

\begin{equation}
N = (X_N , Y_N , D, {M_d }, EIC, EOC, IC, Select)
\end{equation}

donde cada componente es:
\begin{itemize}
\item $X_N$ es el conjunto de eventos de entrada al modelo acoplado, representado por el producto cartesiano del conjunto de puertos de entrada $InPorts$ y el conjunto de posibles valores para cada puerto. O sea un evento de entrada al modelo acoplado está representado por un par $(p, v)$ donde $p \in InPorts$ y $v \in X_p$ .

\item $Y_N$ es el conjunto de eventos que el modelo puede emitir. Es un elemento del producto cartesiano entre el conjunto de puertos de salida $OutPorts$ y el conjunto de posibles valores para este puerto, o sea un evento de salida del modelo acoplado está representado por un par $(p, v)$ donde $p \in OutPorts$ y $v \in Y_p$.

\item $D$ es el conjunto de los índices a los modelos DEVS (atómicos y acoplados) que conforman este modelo. 

\item ${M_d }$ es el conjunto de los modelos atómicos y/o acoplados (son justamente los modelos que "acopla" o "agrupa" este modelo acoplado).

\item EIC y EOC estos conjuntos indican la forma que los modelos internos al acoplado se relacionan con el exterior:
      \begin {itemize}
          \item EIC (o External Input Coupling) son las conexiones de entrada al acoplado, es decir, conecta un puerto de entrada del acoplado con un puerto de entrada de un modelo perteneciente al acoplado.
          \item EOC (o External Output Coupling) son las conexiones de salida del acoplado. Conecta un puerto de salida de un modelo interno del acoplado con un puerto de salida del acoplado. Formalmente:
          $ EIC \in {((N, ip_N ), (d, ip_d )) | ip_N \in InPorts, d \in D, ip d \in InPorts_d } $
          $EOC \in {((d, op_d ), (N, op_N ))  | op_N \in OutPorts, d \in D, op d \in OutPorts_d } $
    
    	donde N es el modelo acoplado.
      \end{itemize}

\item $IC$ representa las conexiones internas del acoplado donde:
\begin{equation}
IC \in {((a, ip_a ), (b, ip_b )) | a, b \in D, ip a \in OutPorts_a , ip_b \in InPorts_b }
\end{equation}
donde no se permite que $a = b$.

\item Select es una función $(D \times D \to D)$ que decide qué modelo realizará primero su transición interna, si se da el caso de eventos simultáneos. Es una función de "desempate" que en ciertos modelos es necesaria.
\end{itemize}

$InPorts$ y $Outports$ son conjuntos que describen los posibles puertos de entrada y salida respectivamente. En general se utilizan números enteros para representar los puertos posibles por lo cual $InPorts = \Na$ y $Outports = \Na$ Los modelos acoplados son en sí mismos modelos DEVS válidos; formalmente el acoplamiento (como lo definimos antes) es una operación cerrada sobre el conjunto de modelos DEVS. Acoplar modelos DEVS forma nuevos modelos DEVS. Sin esta cualidad el acoplamiento resultaría inútil desde del punto de vista del formalismo. También trae muchas ventajas a la hora de describir modelos DEVS y a la hora de simularlos. El acoplamiento da lugar a una estructura jerárquica de desarrollo.

%XXX : Falta figura 2.6 - Ber12, pag. 24

\subsection{Modelos Vectoriales}
BK11
	
\section{Métodos de integración QSS}
QSS paper

\section{PowerDEVS}
Powerdevs Paper

\section{Modelica}
\section{QSS Stand Alone Solver}
QSSPaper

\subsection{$\mu$Modelica}

\chapter{Conversión de modelos DEVS}
\section{Modelos Atómicos}
Cómo se traducen (es conocimiento del modelador, no automático)
\section{Modelos Vectoriales}
Consideraciones  y anotaciones en modelica, modificaciones

\section{Modelos Acoplados Planos}
Modelos acoplados solo con modelos atómicos adentro.	

Mencionar el algoritmo (traducción de conexiones y ``aplanado'' de cada uno de los atómicos hijos``)	

\section{Equivalencia semántica de la conversión}

\section{Modelos Acoplados Jerárquicos}
Explicar cuándo se utilzan y que resolvemos el problema aplanando los acoplados

\subsection{Algoritmo de aplanado}
Describir el algoritmo para PDS

\section{Comparación de performance}
¿No deberia estar despues de "Ejemplos de Aplicación"?

\chapter{Detalles de Implementación}
API Powerdevs, AST Modelica
Traverser
Modelica Transformer


\section{Ejemplos de Aplicación}
tamaños de las vectores y comparativas de 
\subsection{Vector/airs}
\subsection{Vector/lcline}
\nocite{*}
\section{Conclusiones y Trabajo a futuro}


\bibliographystyle{plain}
\bibliography{tesina_luciano}

\end{document}
